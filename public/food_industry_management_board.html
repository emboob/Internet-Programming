<!DOCTYPE html>
<html lang="ko">
    <head>
        <title id="titleCheck">동의대 학생 홈페이지</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
        <style>
            .dropdown-submenu {
                position: relative;
            }
            .dropdown-submenu>.dropdown-menu {
                top: 0;
                left: 100%;
                margin-top: -6px;
                margin-left: -1px;
                -webkit-border-radius: 0 6px 6px 6px;
                -moz-border-radius: 0 6px 6px 6px;
                border-radius: 0 6px 6px 6px;
            }
            .dropdown-submenu:hover>.dropdown-menu {
                display: block;
            }
            .dropdown-submenu>a:after {
                display: block;
                content: " ";
                float: right;
                width: 0;
                height: 0;
                border-color: transparent;
                border-style: solid;
                border-width: 5px 0 5px 5px;
                border-left-color: #cccccc;
                margin-top: 5px;
                margin-right: -10px;
            }
            .dropdown-submenu:hover>a:after {
                border-left-color: #ffffff;
            }
            .dropdown-submenu.pull-left {
                float: none;
            }
            .dropdown-submenu.pull-left>.dropdown-menu {
                left: -100%;
                margin-left: 10px;
                -webkit-border-radius: 6px 0 6px 6px;
                -moz-border-radius: 6px 0 6px 6px;
                border-radius: 6px 0 6px 6px;
            }
        </style>
    </head>

    <body>
        <!-- 네비게이션 바 시작 -->
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/index.html">동의대 학생 홈페이지</a>
                </div>
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="/index.html">Home</a>
                        </li>
                        <li>
                            <a id="joinmenu" href="/join.html">가입</a>
                        </li>
                        <li>
                            <a id="boardmenu" style="margin:0%; padding:0%;"></a>
                        </li>
                        <li>
                            <a id="loginmenu" href="/login.html">로그인</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <br><br><br><br><br>
        <!-- 학과별 게시판 이동 드롭다운 메뉴 -->
        <div style="float: left;">
            <div class="container">
                <ul class="nav navbar-nav">
                    <li class="menu-item dropdown" style="background-color:#e0e0e0">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" style="color:#616161;">학과별 게시판 <b
                                class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li class="menu-item dropdown dropdown-submenu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">인문사회과학대학</a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="korean_literature_board.html">한국어문학과</a>
                                        <a href="chinese_language_board.html">중국어학과</a>
                                        <a href="japanese_language_board.html">일본어학과</a>
                                        <a href="english_board.html">영어학과</a>
                                        <a href="franch_literature_board.html">불어불문학과</a>
                                        <a href="german_literature_board.html">독어독문학과</a>
                                        <a href="history_board.html">사학과</a>
                                        <a href="literature_and_information_board.html">문헌정보학과</a>
                                        <a href="philosophical_counseling_and_psychology_board.html">철학상담·심리학과</a>
                                        <a href="lifelong_education_youth_counseling_board.html">평생교육·청소년상담학과</a>
                                        <a href="early_childhood_education_board.html">유아교육과</a>
                                        <a href="media_and_advertising_board.html">미디어·광고학부</a>
                                        <a href="advertising_and_advertising_board.html">광고홍보학과</a>
                                        <a href="mass_communication_board.html">신문방송학과</a>
                                        <a href="law_and_police_administration_board.html">법·경찰행정학부</a>
                                        <a href="law_board.html">법학과</a>
                                        <a href="police_administration.html">경찰행정학과</a>
                                        <a href="fire_and_disaster_administration_board.html">소방방재행정학과</a>
                                        <a href="public_human_resources_board.html">공공인재학부</a>
                                        <a href="administrative_policy_board.html">행정정책학과</a>
                                        <a href="social_welfare_board.html">사회복지학과</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="divider" style="margin:4px"></li>
                            <li class="menu-item dropdown dropdown-submenu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">상경대학</a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="economics_financial_insurance_board.html">경제·금융보험·재무부동산학부</a>
                                        <a href="economics_board.html">경제학과</a>
                                        <a href="financial_insurance_board.html">금융보험학과</a>
                                        <a href="finance_and_land_board.html">재무부동산학과</a>
                                        <a href="estate_financing_board.html">부동산금융·자산경영학과(직업인 과정)</a>
                                        <a href="trade_and_distribution_board.html">무역·유통학부</a>
                                        <a href="commerce_and_trade_board.html">무역학과</a>
                                        <a href="distribution_and_logistics_board.html">유통물류학과</a>
                                        <a href="business_administration_board.html">경영학부</a>
                                        <a href="business_administer_board.html">경영학과</a>
                                        <a href="accounting_board.html">회계학과</a>
                                        <a href="information_management_board.html">정보경영학부</a>
                                        <a href="management_information_board.html">경영정보학과</a>
                                        <a href="e-business_board.html">e비즈니스학과</a>
                                        <a href="hotel_tourism_outdoor_management_board.html">호텔관광외식경영학부</a>
                                        <a href="international_tourism_management_board.html">국제관광경영학과</a>
                                        <a href="hotel_convention_and_management_board.html">호텔·컨벤션경영학과</a>
                                        <a href="food_industry_management_board.html">외식산업경영학과</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="divider" style="margin:4px"></li>
                            <li class="menu-item dropdown dropdown-submenu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">자연과학대학</a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="mathematics_board.html">수학과</a>
                                        <a href="physics_board.html">물리학과</a>
                                        <a href="chemistry_board.html">화학과</a>
                                        <a href="molecular_biology_board.html">분자생물학과</a>
                                        <a href="bioapplication_board.html">생명응용학과</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="divider" style="margin:4px"></li>
                            <li class="menu-item dropdown dropdown-submenu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">의료보건생활대학</a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="nursing_science_board.html">간호학과</a>
                                        <a href="clinical_pathology_board.html">임상병리학과</a>
                                        <a href="dental_hygiene_board.html">치위생학과</a>
                                        <a href="radiology_board.html">방사선학과</a>
                                        <a href="medical_management_board.html">의료경영학과</a>
                                        <a href="physiotherapy_board.html">물리치료학과</a>
                                        <a href="child_care_and_family_helath_care_board.html">보육·가정상담학과</a>
                                        <a href="food_and_nutrition_board.html">식품영양학과</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="divider" style="margin:4px"></li>
                            <li class="menu-item dropdown dropdown-submenu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">한의과대학</a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="chinese_medicine_board.html">한의예과</a>
                                        <a href="oriental_medicine_board.html">한의학과</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="divider" style="margin:4px"></li>
                            <li class="menu-item dropdown dropdown-submenu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">IT융합부품소재공과대학</a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="new_material_engineering_board.html">신소재공학부</a>
                                        <a href="metallic_materials_engineering_board.html">금속소재공학과</a>
                                        <a href="polymer_material_engineering_board.html">고분자소재공학과</a>
                                        <a href="electrical_and_electronic_materials_engineering_board.html">전기전자소재공학과</a>
                                        <a href="design_and_engineering_board.html">디자인공학부</a>
                                        <a href="product_design_engineering_board.html">제품디자인공학과</a>
                                        <a href="human_system_design_engineering_board.html">인간·시스템디자인공학과</a>
                                        <a href="mechanical_motor_robot_component_engineering_board.html">기계자동차로봇부품공학부</a>
                                        <a href="mechanical_engineering_board.html">기계공학과</a>
                                        <a href="robots_and_automation_engineering_board.html">로봇·자동화공학과</a>
                                        <a href="automotive_engineering_board.html">자동차공학과</a>
                                        <a href="industrial_convergence_systems_engineering_board.html">산업융합시스템공학부</a>
                                        <a href="industrial_ICT_technology_engineering_board.html">산업ICT기술공학과</a>
                                        <a href="production_information_technology_engineering_board.html">생산정보기술공학과</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="divider" style="margin:4px"></li>
                            <li class="menu-item dropdown dropdown-submenu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">공과대학</a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="construction_engineering_board.html">건설공학부</a>
                                        <a href="architect_engineering_board.html">건축학과</a>
                                        <a href="architectural_engineering_board.html">건축공학과</a>
                                        <a href="civil_engineering_board.html">토목공학과</a>
                                        <a href="urban_engineering_board.html">도시공학과</a>
                                        <a href="bioapplication_engineering_board.html">바이오응용공학부</a>
                                        <a href="medicine_and_life_engineering_board.html">의생명공학과</a>
                                        <a href="biomedical_engineering_board.html">바이오의약공학과</a>
                                        <a href="food_engineering_board.html">식품공학과</a>
                                        <a href="chemical_environmental_engineering_board.html">화학환경공학부</a>
                                        <a href="chemical_engineering_board.html">화학공학과</a>
                                        <a href="environmental_engineering_board.html">환경공학과</a>
                                        <a href="applied_chemistry_board.html">응용화학과</a>
                                        <a href="maritime_engineering_board.html">조선해양공학과</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="divider" style="margin:4px"></li>
                            <li class="menu-item dropdown dropdown-submenu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">ICT공과대학</a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="computer_science_board.html">컴퓨터공학과</a>
                                        <a href="creative_software_engineering_board.html">창의소프트웨어공학부</a>
                                        <a href="computer_software_engineering_board.html">컴퓨터소프트웨어공학과</a>
                                        <a href="applied_software_engineering_board.html">응용소프트웨어공학과</a>
                                        <a href="electrical_and_electronic_communication_engineering_board.html">전기전자통신공학부</a>
                                        <a href="electrical_engineering_board.html">전기공학과</a>
                                        <a href="electronic_engineering_board.html">전자공학과</a>
                                        <a href="information_and_communication_engineering_board.html">정보통신공학과</a>
                                        <a href="digital_content_game_animation_engineering_board.html">디지털콘텐츠게임애니메이션공학부</a>
                                        <a href="digital_contents_board.html">디지털콘텐츠학과</a>
                                        <a href="game_animation_engineering_board.html">게임애니메이션공학과</a>
                                        <a href="film_board.html">영화학과</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="divider" style="margin:5px"></li>
                            <li class="menu-item dropdown dropdown-submenu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">예술디자인체육대학</a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="music_board.html">음악학과</a>
                                        <a href="design_and_fabrication_board.html">디자인조형학과</a>
                                        <a href="fashion_design_board.html">패션디자인학과</a>
                                        <a href="physical_education_board.html">체육학과</a>
                                        <a href="leisure_sports_and_taekwondo_board.html">레저스포츠태권도학부</a>
                                        <a href="leisure_and_sports_board.html">레저스포츠학과</a>
                                        <a href="taekwondo_board.html">태권도학과</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <!-- 드롭 다운 메뉴 끝 -->
        <!-- 점보트론 시작 -->
        <div class="container">
            <div class="jumbotron" style="background-color: white">
                <h1>
                    <span style="color:black;">외식산업경영학과</span>
                </h1>
            </div>
        </div>
        <br>
        <!-- 점보트론 끝 -->
        <!-- 쓰기 텍스트 필드 시작-->
        <div>
            <span style="float:left">
                <script async src="//client.uchat.io/uchat.js"></script>
                <u-chat room='csw-deu' style="display:inline-block; width:250px; height:600px; margin-left:25px">
                </u-chat>
            </span>
            <div class="container">
                <div>
                    <h3>게시판</h3>
                    <hr>
                </div>
                <!-- 게시글 리스트 붙일 곳 -->
                <div class="boardList"></div>
                <!-- 글쓰기 버튼 -->
                <a style="float:right;" id="button_board_write" href="/login.html" class="btn btn-success write">글쓰기</a>
                <br><br><br><br>
            </div>
            <!-- 쓰기 텍스트 필드 끝-->
        </div>
        <!-- 스크립트 부분 -->
        <script>
            var firebaseEmailAuth; //파이어베이스 email 인증 모듈 전역변수
            var firebaseDatabase; //파이어베이스 db 모듈 전역변수
            var name; //유저 이름
            var loginUserKey; //로그인한 유저의 부모 key
            var userInfo; //로그인한 유저의 정보 object type
            var dept; // 유저의 학과이름
            var title; // 유저가 쓴 글 제목
            var contents; // 유저가 쓴 글 내용
            //파이어 베이스 초기화 코드
            var firebaseConfig = {
                apiKey: "AIzaSyCxibhzYkH9RgWrNgrLmz-Re38KiYLMfiw",
                authDomain: "https://deu-web-project.firebaseapp.com",
                databaseURL: "https://deu-web-project.firebaseio.com",
                projectId: "deu-web-project",
                storageBucket: "deu-web-project.appspot.com",
                appId: "1:536460023742:web:12f1e5439038e9a9"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            //인증모듈 객체 가져오기
            firebaseEmailAuth = firebase.auth();
            //데이터베이스 모듈객체 가져오기
            firebaseDatabase = firebase.database();
            //세션 체크 함수
            userSessionCheck();
            $(document).ready(function () {
                //메인화면 쓰기버튼 눌렀을 때
                $(document).on('click', '.write', function () {
                    //네비게이션 메뉴의 text값 가져오기 - 자바스크립트 dom 방식으로 가져왔다.
                    var seseionCheck = document.getElementById("loginmenu").textContent;
                    //내가 쓴글 가져오기 - jquery방식으로 가져왔다.
                    title = $('#title').val();
                    contents = $('#contents').val();
                    if (seseionCheck == "로그아웃") {
                        //저장하기
                        saveBoard();
                    } else {
                        alert("로그인이 필요한 서비스 입니다.")
                    }
                });
            });
            //쓰기 버튼 눌렀을 때 호출 되는 함수
            function saveBoard() {
                //board 라는 테이블을 만들고 하위 데이터에 유저 아이디를 넣어준다. 그곳에 push로 가상의 키를 넣고, 객체를 넣어준다.
                var boardRef = firebaseDatabase.ref("board");
                // 해당 객체의 key 값이 자동으로 생성된다.
                var board = boardRef.push(); // 해당 객체의 key 값이 자동으로 생성된다.
                //로그인한 유저의 pk값,이름,내용,글 제목, 내용
                var obj = {
                    userkey: loginUserKey,
                    name: name,
                    title: title,
                    contents: contents
                };
                //위에서 thankRef.push()로 만들어진 key아래 위치에 저장해준다.
                board.set(obj);
                alert("게시글이 저장되었습니다.");
                $('#comment').val("");
            }
            //유저가 로그인 했는지 안했는지 확인해주는 함수
            function userSessionCheck() {
                //로그인이 되어있으면 - 유저가 있으면, user를 인자값으로 넘겨준다.
                firebaseEmailAuth.onAuthStateChanged(function (user) {
                    if (user) {
                        //조회 - 데이터 베이스에 저장된 닉네임을 현재 접속되어 있는 user의 pk key 값을 이용해서 가져오기
                        firebaseDatabase.ref("users/" + user.uid).once('value').then(function (snapshot) {
                            //자바스크립트 dom 선택자를 통해서 네비게이션 메뉴의 엘리먼트 변경해주기
                            document.getElementById("loginmenu").textContent = "로그아웃";
                            document.getElementById("loginmenu").href = "/logout.html";
                            document.getElementById("joinmenu").textContent = "반가워요! " + snapshot.val().Name + " 님";
                            document.getElementById("joinmenu").href = "#";
                            document.getElementById("boardmenu").textContent = snapshot.val().dept;
                            document.getElementById("boardmenu").href = "#";
                            document.getElementById("button_board_write").href = "/boardWrite.html";
                            document.getElementById("boardmenu").style = "padding:15px";

                            name = snapshot.val().Name;   //유저 닉네임은 계속 쓸거기 때문에 전역변수로 할당
                            loginUserKey = snapshot.key;  //로그인한 유저의 key도 계속 쓸 것이기 때문에 전역변수로 할당
                            userInfo = snapshot.val(); //snapshot.val()에 user 테이블에 있는 해당 개체 정보가 넘어온다. userInfo에 대입!
                            dept = snapshot.val().dept;

                            boardList();
                            return true;
                        });
                    } else {
                        boardList();
                        return false;
                    }
                });
            }
            //감사글 목록가져와서 뿌려주기
            function boardList() {
                //로그인한 유저라면
                if (loginUserKey) {
                    //글이 저장된 레퍼런스 값 가져오기
                    var boardRef = firebaseDatabase.ref("board/" + "외식산업경영학과");
                    //on 함수로 글 목록가져오기
                    boardRef.on('child_added', on_board_list);
                } else {
                    alert("실패");
                    return;
                }
            }
            //땡스리스트 thanks 테이블의 thanks 키들을 연속적으로 가져온다.
            function on_board_list(data) {
                var key = data.key;
                var Data = data.val();
                var title = Data.title;
                var name = Data.name;
                var userkey = Data.userkey;
                //감사리스트 동적으로 붙이기
                var html =
                    "<div class=\"media\" id='" + key + "' onclick=\"show_user_page(this.id)\">" +
                    "<div class=\"media-body\">" +
                    "<h5 class=\"media-heading\">" + title +
                    "<div class=\"media-body\">" +
                    "<h6 class=\"media-heading\" id=\"nicname\">" + name + "</h4></div>" +
                    "<hr>";
                $(".boardList").append(html);
            }
            //get으로 키값을 보내는 함수
            function show_user_page(some_data) {
                var datalist = some_data;
                var form = document.createElement("form");
                form.setAttribute("charset", "UTF-8");
                form.setAttribute("method", "get");
                form.setAttribute("action", "boardView.html");
                var hiddenField = document.createElement("input");
                hiddenField.setAttribute("type", "hidden");
                hiddenField.setAttribute("name", "data");
                hiddenField.setAttribute("value", datalist);
                form.appendChild(hiddenField);
                var url = "boardView.html"
                var title = "_self"
                form.target = title;
                document.body.appendChild(form);
                form.submit();
            }
        </script>
    </body>
</html>